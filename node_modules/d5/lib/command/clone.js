var fs = require('fs'),
    path = require('path'),
    mkdirp = require('mkdirp'),
    wash = require('wash'),
    execSync = require('../execSync'),
    _ = require('underscore');

var yargs = require('yargs')
    .option('p', { alias: 'protocol', default: 'https', describe: 'protocol: ssh, https' })
    .boolean('q').alias('q', 'quiet').describe('q', 'no output at all');

exports = module.exports = function(args) {
    argv = yargs.parse(args);
    if(argv._.length == 0) {
        console.error('Usage: d5 clone {userName}/{projectName} [opts ...]');
        process.exit(1);
    }

    var projectName = argv._[0];
    if(projectName.split('/').length != 2) {
        console.error('Error: invalid userName and projectName "' + projectName + '"');
        process.exit(1);
    }

    var url = null;
    if(argv.p == 'https') {
        url = 'https://github.com/' + projectName + '.git';
    } else if(argv.p == 'ssh') {
        url = 'git@github.com:' + projectName + '.git';
    } else {
        console.error('Error: unknown protocol "' + argv.p + '"');
        process.exit(1);
    }

    var output = execSync('git clone ' + url);

    if(!argv.q) {
        if(output.exitCode == 0) {
            console.log('Cloning done.');
        } else {
            output.outputToConsole();    
        }
    }

    process.exit(output.exitCode);
};

exports.help = function() {
    console.log('Clone a project from github.');
    console.log('Usage: d5 clone {userName}/{projectName} [opts ...]');
    console.log();
    yargs.showHelp();
};